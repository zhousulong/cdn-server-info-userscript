# CDN Server Info Userscript - AI åä½œè§„åˆ™

## ğŸ¯ é¡¹ç›®æ ¸å¿ƒåŸåˆ™

è¿™æ˜¯ä¸€ä¸ªç”¨äºæ£€æµ‹å’Œæ˜¾ç¤º CDN/æœåŠ¡å™¨ä¿¡æ¯çš„ Tampermonkey ç”¨æˆ·è„šæœ¬ã€‚åœ¨ä¿®æ”¹ä»£ç å‰ï¼Œ**å¿…é¡»**å…ˆç†è§£ä»¥ä¸‹å…³é”®åŸåˆ™ã€‚

---

## ğŸ“‹ CDN æ£€æµ‹è§„åˆ™ (`cdn_rules.json`)

### âœ… DO - æ­£ç¡®åšæ³•

1. **ä½¿ç”¨ CDN ä¸“æœ‰å¤´**
   ```json
   {
     "Cloudflare": {
       "headers": {
         "cf-ray": null,           // âœ… Cloudflare ä¸“æœ‰
         "cf-cache-status": null   // âœ… Cloudflare ä¸“æœ‰
       }
     }
   }
   ```

2. **ä½¿ç”¨å¸¦å€¼åŒ¹é…çš„é€šç”¨å¤´**
   ```json
   {
     "SwiftServe CDN": {
       "headers": {
         "x-cache": "swiftserve"   // âœ… åŒ¹é…ç‰¹å®šå€¼
       }
     },
     "Kingsoft Cloud": {
       "headers": {
         "x-cache-status": "KS-CLOUD-"  // âœ… åŒ¹é…ç‰¹å®šå‰ç¼€
       }
     }
   }
   ```

3. **ä½¿ç”¨æ­£åˆ™æ¨¡å¼åŒ¹é…**
   ```json
   {
     "AWS CloudFront": {
       "via": "cloudfront\\.net"   // âœ… ç‰¹å®šåŸŸåæ¨¡å¼
     }
   }
   ```

4. **ç»„åˆå¤šä¸ªç‹¬ç‰¹å¤´**
   ```json
   {
     "Akamai": {
       "headers": {
         "x-akamai-transformed": null,
         "x-akamai-request-id": null,
         "server-timing": "ak_p"
       }
     }
   }
   ```

### âŒ DON'T - é”™è¯¯åšæ³•

1. **ç¦æ­¢ä½¿ç”¨è¶…çº§é€šç”¨å¤´**
   ```json
   // âŒ é”™è¯¯ç¤ºä¾‹
   {
     "HiNet CDN": {
       "headers": {
         "x-request-id": null,  // âŒ å‡ ä¹æ‰€æœ‰æœåŠ¡å™¨éƒ½æœ‰
         "x-cache": null        // âŒ å¤ªé€šç”¨ï¼Œå¾ˆå¤š CDN éƒ½ç”¨
       }
     }
   }
   ```

2. **ç¦æ­¢ä½¿ç”¨æ— ç‰¹å¾çš„é€šç”¨å¤´**
   ```json
   // âŒ é”™è¯¯ç¤ºä¾‹
   {
     "Gcore": {
       "headers": {
         "cache": null,         // âŒ å¤ªé€šç”¨
         "x-id": null           // âŒ å¤ªé€šç”¨
       }
     }
   }
   ```

### ğŸš¨ é«˜é£é™©é€šç”¨å¤´åˆ—è¡¨ï¼ˆé¿å…ä½¿ç”¨ï¼‰

- `x-request-id` - å‡ ä¹æ‰€æœ‰æœåŠ¡å™¨éƒ½ç”¨
- `x-cache` - é™¤éæœ‰å€¼åŒ¹é…ï¼ˆå¦‚ `"x-cache": "swiftserve"`ï¼‰
- `cache` - å¤ªé€šç”¨
- `x-id` - å¤ªé€šç”¨
- `x-served-by` - Akamai å’Œ Fastly éƒ½ç”¨ï¼Œéœ€è°¨æ…
- `x-link-via` - å¤šä¸ª CDN ä½¿ç”¨

### ğŸ“Š ä¼˜å…ˆçº§æŒ‡å—

- **15+**: æœ‰å¤šä¸ªç‹¬ç‰¹å¤´çš„é«˜å¯ä¿¡åº¦ CDN
- **12-14**: æœ‰ç‰¹å®šå¤´ç»„åˆçš„ CDN
- **10-11**: æ ‡å‡† CDNï¼ˆå¤§å¤šæ•°ï¼‰
- **8-9**: æ¬¡è¦ CDN æˆ–æœ‰å†²çªé£é™©çš„
- **5-7**: é€šç”¨æœåŠ¡å™¨ï¼ˆNginx, Apache, LiteSpeedï¼‰

**é‡è¦**: è°ƒæ•´ä¼˜å…ˆçº§**ä¸èƒ½**è§£å†³å¤´å†²çªé—®é¢˜ï¼Œåªæœ‰**æ›´ç²¾ç¡®çš„è§„åˆ™**æ‰èƒ½ï¼

---

## ğŸ¨ CDN Logo è§„åˆ™ (`cdnIcons` in JS)

### âœ… DO - æ­£ç¡®åšæ³•

1. **ä½¿ç”¨ `fill="currentColor"`**
   ```svg
   <svg viewBox="0 0 100 100">
     <path fill="currentColor" d="..."/>
     <circle fill="currentColor" fill-opacity="0.7" cx="50" cy="50" r="20"/>
   </svg>
   ```

2. **ä½¿ç”¨ `fill-opacity` ä¿æŒå±‚æ¬¡**
   ```svg
   <path fill="currentColor" fill-opacity="1.0" d="..."/>    <!-- ä¸»è¦å…ƒç´  -->
   <path fill="currentColor" fill-opacity="0.7" d="..."/>    <!-- æ¬¡è¦å…ƒç´  -->
   <path fill="currentColor" fill-opacity="0.5" d="..."/>    <!-- è£…é¥°å…ƒç´  -->
   ```

3. **ç§»é™¤å†…è”æ ·å¼å’Œ `<defs>`**
   ```svg
   <!-- âŒ é”™è¯¯ -->
   <svg>
     <defs>
       <style>.cls-1{fill:#004097}</style>
     </defs>
     <path class="cls-1" d="..."/>
   </svg>

   <!-- âœ… æ­£ç¡® -->
   <svg>
     <path fill="currentColor" d="..."/>
   </svg>
   ```

### âŒ DON'T - é”™è¯¯åšæ³•

1. **ä¸è¦ä½¿ç”¨å›ºå®šé¢œè‰²**
   ```svg
   <!-- âŒ é”™è¯¯ -->
   <path fill="#004097" d="..."/>
   <circle fill="rgb(236, 28, 36)" cx="50" cy="50" r="20"/>
   ```

2. **ä¸è¦ä½¿ç”¨ CSS ç±»å**
   ```svg
   <!-- âŒ é”™è¯¯ -->
   <style>.cls-1{fill:#004097}</style>
   <path class="cls-1" d="..."/>
   ```

### ğŸ¯ Logo æ·»åŠ ä½ç½®

åœ¨ `cdn-server-info.user.js` çš„ `cdnIcons` å¯¹è±¡ä¸­ï¼ˆçº¦ç¬¬ 822 è¡Œï¼‰:

```javascript
const cdnIcons = {
    'Cloudflare': `<svg>...</svg>`,
    'Akamai': `<svg>...</svg>`,
    'Your CDN': `<svg>...</svg>`,  // æ·»åŠ åœ¨è¿™é‡Œ
};
```

---

## ğŸ” ç¼“å­˜çŠ¶æ€æ£€æµ‹è§„åˆ™

### æ·»åŠ æ–°çš„ç¼“å­˜å¤´

åœ¨ `getCacheStatus` å‡½æ•°çš„ `headersToCheck` æ•°ç»„ä¸­æ·»åŠ ï¼ˆçº¦ç¬¬ 66 è¡Œï¼‰:

```javascript
const headersToCheck = [
    h.get('eo-cache-status'),     // ä¼˜å…ˆæ£€æŸ¥ç‰¹å®šå¤´
    h.get('hascache'),             // Kestrel
    h.get('x-cache'),              // é€šç”¨å¤´æ”¾åé¢
    // ... å…¶ä»–å¤´
];
```

**åŸåˆ™**:
- âœ… ç‰¹å®šçš„ã€ç‹¬ç‰¹çš„å¤´æ”¾åœ¨**å‰é¢**
- âœ… é€šç”¨çš„å¤´æ”¾åœ¨**åé¢**
- âœ… æ£€æµ‹é€»è¾‘ä¼šè‡ªåŠ¨æå– HIT/MISS/BYPASS/DYNAMIC

---

## ğŸ› å¸¸è§é”™è¯¯ä¸ä¿®å¤

### é”™è¯¯ 1: è¯¯è¯†åˆ«é—®é¢˜

**ç—‡çŠ¶**: CDN A è¢«è¯†åˆ«æˆ CDN B

**åŸå› **: ä½¿ç”¨äº†é€šç”¨å¤´

**ä¿®å¤**:
1. æ£€æŸ¥ä¸¤ä¸ª CDN çš„ `headers` é…ç½®
2. ç§»é™¤é€šç”¨å¤´ï¼Œåªä¿ç•™ä¸“æœ‰å¤´
3. å¦‚æœå¿…é¡»ç”¨é€šç”¨å¤´ï¼Œæ·»åŠ å€¼åŒ¹é…

### é”™è¯¯ 2: Logo é¢œè‰²ä¸é€‚é…ä¸»é¢˜

**ç—‡çŠ¶**: Logo åœ¨æ·±è‰²/æµ…è‰²ä¸»é¢˜ä¸‹ä¸å¯è§

**åŸå› **: ä½¿ç”¨äº†å›ºå®šé¢œè‰²è€Œä¸æ˜¯ `currentColor`

**ä¿®å¤**:
1. å°†æ‰€æœ‰ `fill="#xxx"` æ”¹ä¸º `fill="currentColor"`
2. ç§»é™¤ `<defs><style>` éƒ¨åˆ†
3. ä½¿ç”¨ `fill-opacity` ä¿æŒå±‚æ¬¡

### é”™è¯¯ 3: ä¼˜å…ˆçº§è°ƒæ•´æ— æ•ˆ

**ç—‡çŠ¶**: è°ƒæ•´äº†ä¼˜å…ˆçº§ä½†ä»ç„¶è¯¯è¯†åˆ«

**åŸå› **: ä¼˜å…ˆçº§ä¸èƒ½è§£å†³å¤´å†²çª

**ä¿®å¤**:
1. **ä¸è¦**é€šè¿‡è°ƒæ•´ä¼˜å…ˆçº§è§£å†³å†²çª
2. ä¿®æ”¹è§„åˆ™ï¼Œä½¿ç”¨æ›´ç²¾ç¡®çš„å¤´
3. æ·»åŠ å€¼åŒ¹é…æˆ–æ­£åˆ™æ¨¡å¼

---

## ğŸ“ ç‰ˆæœ¬æ›´æ–°è§„èŒƒ

### ç‰ˆæœ¬å·è§„åˆ™

- **Major (x.0.0)**: é‡å¤§æ¶æ„å˜æ›´
- **Minor (7.x.0)**: æ–°åŠŸèƒ½ã€æ–° CDN æ”¯æŒ
- **Patch (7.27.x)**: Bug ä¿®å¤ã€å°ä¼˜åŒ–

### æ›´æ–°ä½ç½®

éœ€è¦åŒæ—¶æ›´æ–° 3 ä¸ªåœ°æ–¹:

1. **`cdn-server-info.user.js`** (ç¬¬ 5-7 è¡Œ):
   ```javascript
   // @version      7.27.0
   // @description  [v7.27.0] æ›´æ–°è¯´æ˜
   ```

2. **`cdn-server-info.user.js`** (ç¬¬ 17 è¡Œ):
   ```javascript
   // @resource     cdn_rules https://...?v=7.27.0
   ```

3. **ç‰ˆæœ¬è¯´æ˜**: ç®€æ´æè¿°ä¸»è¦å˜æ›´

---

## ğŸ”§ è‡ªå®šä¹‰å¤„ç†å™¨è§„åˆ™

### ä½•æ—¶éœ€è¦è‡ªå®šä¹‰å¤„ç†å™¨

å½“ CDN çš„ç¼“å­˜çŠ¶æ€æˆ– POP æå–é€»è¾‘**æ— æ³•ç”¨é€šç”¨è§„åˆ™å¤„ç†**æ—¶:

```javascript
const customHandlers = {
    'SwiftServe CDN': {
        getInfo: (h, rule) => {
            // ä» "HIT from da010.vn17.swiftserve.com" æå–
            const xCache = h.get('x-cache');
            const match = xCache.match(/from\s+([a-z0-9]+)\.([a-z0-9]+)\.swiftserve\.com/i);
            const pop = match ? match[2].toUpperCase() : 'N/A';
            
            return {
                provider: 'SwiftServe CDN',
                cache: getCacheStatus(h),
                pop: pop,
                extra: 'Detected via x-cache header'
            };
        }
    }
};
```

### ä½•æ—¶ä¸éœ€è¦

å¦‚æœåªæ˜¯ç®€å•çš„å¤´åŒ¹é…ï¼Œç”¨ JSON è§„åˆ™å°±å¤Ÿäº†:

```json
{
  "Simple CDN": {
    "headers": {
      "x-simple-cdn": null
    },
    "pop_header": "x-cdn-pop",
    "id_header": "x-request-id"
  }
}
```

---

## ğŸ“š ä¿®æ”¹å‰å¿…è¯»æ¸…å•

åœ¨ä¿®æ”¹ä»£ç å‰ï¼Œ**å¿…é¡»**æ£€æŸ¥:

- [ ] æ˜¯å¦æŸ¥çœ‹äº† `cdn_rules.json` ä¸­å·²æœ‰çš„è§„åˆ™ï¼Ÿ
- [ ] æ–°å¢çš„å¤´æ˜¯å¦æ˜¯ CDN ä¸“æœ‰çš„ï¼Ÿ
- [ ] æ˜¯å¦é¿å…äº†ä½¿ç”¨é€šç”¨å¤´ï¼ˆ`x-request-id`, `cache`, `x-id`ï¼‰ï¼Ÿ
- [ ] å¦‚æœä½¿ç”¨é€šç”¨å¤´ï¼Œæ˜¯å¦æ·»åŠ äº†å€¼åŒ¹é…ï¼Ÿ
- [ ] Logo æ˜¯å¦ä½¿ç”¨äº† `fill="currentColor"`ï¼Ÿ
- [ ] æ˜¯å¦ç§»é™¤äº† Logo ä¸­çš„å›ºå®šé¢œè‰²å’Œ CSS ç±»ï¼Ÿ
- [ ] æ˜¯å¦åŒæ—¶æ›´æ–°äº†ç‰ˆæœ¬å·çš„ 3 ä¸ªä½ç½®ï¼Ÿ
- [ ] æ˜¯å¦ç†è§£ä¼˜å…ˆçº§ä¸èƒ½è§£å†³å¤´å†²çªï¼Ÿ

---

## ğŸ“ å­¦ä¹ èµ„æº

### ç†è§£é¡¹ç›®ç»“æ„

1. **`cdn_rules.json`**: CDN æ£€æµ‹è§„åˆ™ï¼ˆJSON é…ç½®ï¼‰
2. **`customHandlers`**: å¤æ‚é€»è¾‘å¤„ç†å™¨ï¼ˆJavaScriptï¼‰
3. **`cdnIcons`**: CDN Logo SVGï¼ˆJavaScript å¯¹è±¡ï¼‰
4. **`getCacheStatus`**: ç¼“å­˜çŠ¶æ€æ£€æµ‹å‡½æ•°

### è°ƒè¯•æŠ€å·§

1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„ Network æ ‡ç­¾
2. æ£€æŸ¥å“åº”å¤´ä¸­çš„ç‰¹å¾å­—æ®µ
3. åœ¨ `parseInfo` å‡½æ•°ä¸­æ·»åŠ  `console.log` è°ƒè¯•
4. æµ‹è¯•å¤šä¸ªä½¿ç”¨è¯¥ CDN çš„ç½‘ç«™

---

## âš ï¸ ç‰¹åˆ«æ³¨æ„

1. **æ°¸è¿œä¸è¦**å‡è®¾ä¸€ä¸ªå¤´æ˜¯ç‹¬ç‰¹çš„ï¼Œå…ˆæœç´¢ `cdn_rules.json` ç¡®è®¤
2. **æ°¸è¿œä¸è¦**é€šè¿‡æé«˜ä¼˜å…ˆçº§æ¥"ä¿®å¤"è¯¯è¯†åˆ«
3. **æ°¸è¿œä¸è¦**åœ¨ Logo SVG ä¸­ä½¿ç”¨å›ºå®šé¢œè‰²
4. **æ°¸è¿œè®°ä½**ï¼šç²¾ç¡®çš„è§„åˆ™ > ä¼˜å…ˆçº§è°ƒæ•´

---

*æœ€åæ›´æ–°: 2025-12-19*
*ç‰ˆæœ¬: v7.27.0*
